<div class="o_video_run o_clearfix">
	<div class="olatFlashMovieViewer">
		<video id="$r.getId("o_vid")" width="$width" height="$height" poster="$mediaUrl/poster.jpg" controls  #if( $autoplay ) autoplay #end class="o_video">			
   			#set( $hasOptimizedVideo = false)
	    	#foreach( $video in $videos)
	    		#if($video.getTranscodingStatus() == 100)
	    			#set( $hasOptimizedVideo = true)
		    		<source type="video/mp4" src="$mediaUrl/optimizedVideoData/${video.getResolution()}video.mp4" title="$r.translate("quality.type.${video.getType()}") (${video.getFileSize()})"/>
	    		#end
	    	#end	    	
	    	## Use master video file if not optimized video is found
	    	#if (!$hasOptimizedVideo)
		    	<source type="video/mp4" src="$mediaUrl/media/$filename" />
		    #end
	    	
	  		#if( $trackfiles )
		  		#foreach( $track in $trackfiles.keySet())
		  		<track kind="subtitles" src="$mediaUrl/$trackfiles.get($track)" srclang="$track" />
		  		#end
		  	#end
		</video>


		<script defer="defer" type="text/javascript">
		// <![CDATA[
		## using jQuery
		var mediaElementBaseUrl = BPlayer._mediaElementBaseUrl();
		jQuery('#$r.getId("o_vid")').mediaelementplayer({
			enablePluginDebug: BPlayer.debugEnabled,

			## Configuration for flash fallback			
			## Set mode:'shim' to force flash usage
			pluginPath: mediaElementBaseUrl,
			flashName: 'flashmediaelement.swf',
			silverlightName: 'silverlightmediaelement.xap',
			plugins: ['flash','silverlight'],
			
			## Enabled features - should be same order as in player.js. 
			## Special here is tracks and sourcechooser which are not available in player.js
			features: ['playpause','current','volume','progress','duration','tracks','sourcechooser','fullscreen'],
			
			## Callback to communicate with the server
			success: function (mediaElement, domObject) {
		        ## listen to play events, fired when movie is finished
		        mediaElement.addEventListener('play', function(e) {
		        	if (!o_info.linkbusy) {
		        		$r.openJavaScriptCommand("play"), 'currentTime', mediaElement.currentTime);
					}
		        }, false);
		        ## listen to pause events, fired when movie is paused by user
		        mediaElement.addEventListener('pause', function(e) {
		        	if (!o_info.linkbusy) {
						$r.openJavaScriptCommand("pause"), 'currentTime', mediaElement.currentTime);
					}
		        }, false);
		        ## listen to seeked events, fired when user uses the slider in the movie
		        mediaElement.addEventListener('seeked', function(e) {
		        	if (!o_info.linkbusy) {
						$r.openJavaScriptCommand("seeked"), 'currentTime', mediaElement.currentTime);
					}
		        }, false);
		        ## listen to end events, fired when movie is finished
		        mediaElement.addEventListener('ended', function(e) {
		        	if (!o_info.linkbusy) {
						$r.openJavaScriptCommand("ended"), 'currentTime', mediaElement.currentTime);
					}
		        }, false);
			}
		});
		// ]]>
		</script>
	</div>
	#if($r.available("commentsAndRating"))
		$r.render("commentsAndRating")
	#end
	<div class="o_desc">
		$description
	</div>
</div>