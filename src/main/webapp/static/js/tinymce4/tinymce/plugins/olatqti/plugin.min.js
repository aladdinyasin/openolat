(function(){tinymce.create("org.olat.ims.qti21.ui.editor",{getInfo:function(){return{longname:"OpenOLATQTI",author:"frentix GmbH",authorurl:"http://www.frentix.com",infourl:"http://www.frentix.com",version:"1.0.0"}},createControl:function(b,a){return null},init:function(h,a){var f=h.$;var d,e;var g;var l;function i(){if(d){return d}var m=o_getMainWin();if(m){d=jQuery(document).ooTranslator().getTranslator(m.o_info.locale,"org.olat.ims.qti21.ui.editor")}else{d={translate:function(n){return n}}}return d}function c(){if(e){return e}var m=o_getMainWin();if(m){e=jQuery(document).ooTranslator().getTranslator(m.o_info.locale,"org.olat.core")}else{e={translate:function(n){return n}}}return e}function k(r){var q=false;var o;if(typeof l!="undefined"){o=jQuery(l).attr("data-qti-gap-identifier")}else{var n=1;tinymce.each(h.dom.select("img[data-qti]"),function(u){var t=jQuery(u).attr("data-qti-gap-identifier");if(t.lastIndexOf("RESPONSE_",0)==0){var v=parseInt(t.substring(9,t.length));if(v>n){n=v}}});var o="RESPONSE_"+(n+1);var s=j(o);var m=new tinymce.html.Serializer().serialize(s);h.insertContent(m);q=true}var p=h.getParam("ffxhrevent");o_ffXHREvent(p.formNam,p.dispIdField,p.dispId,p.eventIdField,2,false,false,"cmd","gapentry","responseIdentifier",o,"newEntry",q)}h.addButton("olatqti",{title:i().translate("new.fib"),icon:"gaptext",stateSelector:["img[data-qti]","span[data-qti]"],onclick:k});h.addButton("editgap",{title:"edit",icon:"edit",onclick:k});h.addMenuItem("olatqti",{text:i().translate("new.fib"),icon:"gaptext",stateSelector:["img[data-qti]","span[data-qti]"],onclick:k});h.on("NodeChange",function(m){if(l&&l.id!=m.element.src){l=undefined}if(b(m.element)){l=m.element}});function b(m){return h.dom.is(m,"img[data-qti]")}function j(m){var n=new tinymce.html.Node("img",1);n.attr({width:"32",height:"16",src:tinymce.Env.transparentSrc,"data-qti":"textentryinteraction","data-qti-gap-identifier":m,"data-mce-placeholder":"","data-mce-resize":"false","data-textentryinteraction":"empty","class":"mce-shim textentryinteraction"});return n}h.on("init",function(){if(h.settings.content_css!==false){h.dom.loadCSS(a+"/css/content.css")}});h.on("preInit",function(){h.parser.addNodeFilter("textentryinteraction",function(n){var p=n.length,r,q,o;while(p--){r=n[p];if(r.name=="textentryinteraction"){var m=r.attr("responseidentifier");var q=j(m);r.replace(q)}}})});h.on("PreProcess",function(m){tinymce.each(h.dom.select("img[data-qti]"),function(o){var n=jQuery(o).attr("data-qti-gap-identifier");var p=h.dom.create("textEntryInteraction",{responseIdentifier:n});h.dom.replace(p,o,false)})})}});tinymce.PluginManager.add("olatqti",org.olat.ims.qti21.ui.editor)})();