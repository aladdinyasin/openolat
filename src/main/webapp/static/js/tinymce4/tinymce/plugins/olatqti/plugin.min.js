(function(){tinymce.create("org.olat.ims.qti21.ui.editor",{getInfo:function(){return{longname:"OpenOLATQTI",author:"frentix GmbH",authorurl:"http://www.frentix.com",infourl:"http://www.frentix.com",version:"1.0.0"}},createControl:function(b,a){return null},init:function(i,a){var f=i.$,n=i.selection;var d,e;var g;var o;function k(){if(d){return d}var p=o_getMainWin();if(p){d=jQuery(document).ooTranslator().getTranslator(p.o_info.locale,"org.olat.ims.qti21.ui.editor")}else{d={translate:function(q){return q}}}return d}function c(){if(e){return e}var p=o_getMainWin();if(p){e=jQuery(document).ooTranslator().getTranslator(p.o_info.locale,"org.olat.core")}else{e={translate:function(q){return q}}}return e}function h(p){m(p,"string")}function j(p){m(p,"float")}function m(s,v){var q=false;var t=null;var x;if(typeof o!="undefined"){x=jQuery(o).attr("data-qti-gap-identifier")}else{var p=1;t=i.selection.getContent({format:"text"});tinymce.each(i.dom.select("img[data-qti]"),function(z){var y=jQuery(z).attr("data-qti-gap-identifier");if(y.lastIndexOf("RESPONSE_",0)==0){var A=parseInt(y.substring(9,y.length));if(A>p){p=A}}});var x="RESPONSE_"+(p+1);var u=l(x,v);var r=new tinymce.html.Serializer().serialize(u);i.insertContent(r);q=true}var w=i.getParam("ffxhrevent");o_ffXHREvent(w.formNam,w.dispIdField,w.dispId,w.eventIdField,2,false,false,false,"cmd","gapentry","responseIdentifier",x,"newEntry",q,"selectedText",t,"gapType",v)}i.addButton("olatqtifibtext",{title:k().translate("new.fib"),icon:"gaptext",stateSelector:["img[data-qti-gap-type=string]","span[data-qti-gap-type=string]"],onclick:h});i.addButton("olatqtifibnumerical",{title:k().translate("new.fib")+" Numerical",icon:"gapnumerical",stateSelector:["img[data-qti-gap-type=float]","span[data-qti-gap-type=float]"],onclick:j});i.addButton("editgap",{title:"edit",icon:"edit",onclick:m});i.addMenuItem("olatqtifibtext",{text:k().translate("new.fib"),icon:"gapnumerical",stateSelector:["img[data-qti-gap-type=string]","span[data-qti-gap-type=string]"],onclick:j});i.addMenuItem("olatqtifibnumerical",{text:k().translate("new.fib.numerical")+" Numerical",icon:"gaptext",stateSelector:["img[data-qti-gap-type=float]","span[data-qti-gap-type=float]"],onclick:h});i.on("NodeChange",function(p){if(o&&o.id!=p.element.src){o=undefined}if(b(p.element)){o=p.element}});function b(p){return i.dom.is(p,"img[data-qti]")}function l(q,p){var r=new tinymce.html.Node("img",1);r.attr({width:"32",height:"16",src:tinymce.Env.transparentSrc,"data-qti":"textentryinteraction","data-qti-gap-identifier":q,"data-qti-gap-type":p,"data-mce-placeholder":"","data-mce-resize":"false","data-textentryinteraction":"empty","class":"mce-shim textentryinteraction"});return r}i.on("init",function(){if(i.settings.content_css!==false){i.dom.loadCSS(a+"/css/content.css")}jQuery("img.textentryinteraction",i.getBody()).each(function(p,q){var r=q;jQuery(r).click(function(){var t=i.getParam("ffxhrevent");var s=jQuery(r).attr("data-qti-gap-identifier");o_ffXHREvent(t.formNam,t.dispIdField,t.dispId,t.eventIdField,2,false,false,"cmd","gapentry","responseIdentifier",s)})})});i.on("preInit",function(){i.parser.addNodeFilter("textentryinteraction",function(r){var t=r.length,v,u,s;while(t--){v=r[t];if(v.name=="textentryinteraction"){var q=v.attr("responseidentifier");var p=v.attr("openolattype");if(typeof p==="undefined"){p="string"}var u=l(q,p);v.replace(u)}}})});i.on("PreProcess",function(p){tinymce.each(i.dom.select("img[data-qti]"),function(r){var q=jQuery(r).attr("data-qti-gap-identifier");var s=i.dom.create("textEntryInteraction",{responseIdentifier:q});i.dom.replace(s,r,false)})})}});tinymce.PluginManager.add("olatqti",org.olat.ims.qti21.ui.editor)})();