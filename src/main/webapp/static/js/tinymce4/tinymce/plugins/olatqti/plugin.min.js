(function(){tinymce.create("org.olat.ims.qti21.ui.editor",{getInfo:function(){return{longname:"OpenOLATQTI",author:"frentix GmbH",authorurl:"http://www.frentix.com",infourl:"http://www.frentix.com",version:"1.0.0"}},createControl:function(b,a){return null},init:function(i,a){var f=i.$;var d,e;var g;var n;function k(){if(d){return d}var o=o_getMainWin();if(o){d=jQuery(document).ooTranslator().getTranslator(o.o_info.locale,"org.olat.ims.qti21.ui.editor")}else{d={translate:function(p){return p}}}return d}function c(){if(e){return e}var o=o_getMainWin();if(o){e=jQuery(document).ooTranslator().getTranslator(o.o_info.locale,"org.olat.core")}else{e={translate:function(p){return p}}}return e}function h(o){m(o,"string")}function j(o){m(o,"float")}function m(u,o){var t=false;var r;if(typeof n!="undefined"){r=jQuery(n).attr("data-qti-gap-identifier")}else{var q=1;tinymce.each(i.dom.select("img[data-qti]"),function(x){var w=jQuery(x).attr("data-qti-gap-identifier");if(w.lastIndexOf("RESPONSE_",0)==0){var y=parseInt(w.substring(9,w.length));if(y>q){q=y}}});var r="RESPONSE_"+(q+1);var v=l(r,o);var p=new tinymce.html.Serializer().serialize(v);i.insertContent(p);t=true}var s=i.getParam("ffxhrevent");o_ffXHREvent(s.formNam,s.dispIdField,s.dispId,s.eventIdField,2,false,false,"cmd","gapentry","responseIdentifier",r,"newEntry",t,"gapType",o)}i.addButton("olatqtifibtext",{title:k().translate("new.fib"),icon:"gaptext",stateSelector:["img[data-qti-gap-type=string]","span[data-qti-gap-type=string]"],onclick:h});i.addButton("olatqtifibnumerical",{title:k().translate("new.fib")+" Numerical",icon:"gapnumerical",stateSelector:["img[data-qti-gap-type=float]","span[data-qti-gap-type=float]"],onclick:j});i.addButton("editgap",{title:"edit",icon:"edit",onclick:m});i.addMenuItem("olatqtifibtext",{text:k().translate("new.fib"),icon:"gapnumerical",stateSelector:["img[data-qti-gap-type=string]","span[data-qti-gap-type=string]"],onclick:j});i.addMenuItem("olatqtifibnumerical",{text:k().translate("new.fib.numerical")+" Numerical",icon:"gaptext",stateSelector:["img[data-qti-gap-type=float]","span[data-qti-gap-type=float]"],onclick:h});i.on("NodeChange",function(o){if(n&&n.id!=o.element.src){n=undefined}if(b(o.element)){n=o.element}});function b(o){return i.dom.is(o,"img[data-qti]")}function l(p,o){var q=new tinymce.html.Node("img",1);q.attr({width:"32",height:"16",src:tinymce.Env.transparentSrc,"data-qti":"textentryinteraction","data-qti-gap-identifier":p,"data-qti-gap-type":o,"data-mce-placeholder":"","data-mce-resize":"false","data-textentryinteraction":"empty","class":"mce-shim textentryinteraction"});return q}i.on("init",function(){if(i.settings.content_css!==false){i.dom.loadCSS(a+"/css/content.css")}});i.on("preInit",function(){i.parser.addNodeFilter("textentryinteraction",function(q){var s=q.length,u,t,r;while(s--){u=q[s];if(u.name=="textentryinteraction"){var p=u.attr("responseidentifier");var o=u.attr("openolattype");if(typeof o==="undefined"){o="string"}var t=l(p,o);u.replace(t)}}})});i.on("PreProcess",function(o){tinymce.each(i.dom.select("img[data-qti]"),function(q){var p=jQuery(q).attr("data-qti-gap-identifier");var r=i.dom.create("textEntryInteraction",{responseIdentifier:p});i.dom.replace(r,q,false)})})}});tinymce.PluginManager.add("olatqti",org.olat.ims.qti21.ui.editor)})();